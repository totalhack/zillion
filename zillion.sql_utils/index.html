<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Make sense of it all."><link href=https://totalhack.github.io/zillion/zillion.sql_utils/ rel=canonical><meta name=author content=totalhack><link rel="shortcut icon" href=../images/chart-donut.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-5.2.1"><title>zillion.sql_utils - Zillion</title><link rel=stylesheet href=../assets/stylesheets/main.71dfd922.min.css><link rel=stylesheet href=../assets/stylesheets/palette.616af814.min.css><meta name=theme-color content=#546e7a><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=stylesheet href=../css/extra.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=light-blue> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#module-zillionsql_utils class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=https://totalhack.github.io/zillion/ title=Zillion class="md-header-nav__button md-logo" aria-label=Zillion> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 2.05v3.03c3.39.49 6 3.39 6 6.92 0 .9-.18 1.75-.5 2.54l2.62 1.53c.56-1.24.88-2.62.88-4.07 0-5.18-3.95-9.45-9-9.95M12 19a7 7 0 01-7-7c0-3.53 2.61-6.43 6-6.92V2.05c-5.06.5-9 4.76-9 9.95a10 10 0 0010 10c3.3 0 6.23-1.61 8.05-4.09l-2.6-1.53A6.89 6.89 0 0112 19z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Zillion </span> <span class="md-header-nav__topic md-ellipsis"> zillion.sql_utils </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/totalhack/zillion/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> totalhack/zillion </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://totalhack.github.io/zillion/ title=Zillion class="md-nav__button md-logo" aria-label=Zillion> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 2.05v3.03c3.39.49 6 3.39 6 6.92 0 .9-.18 1.75-.5 2.54l2.62 1.53c.56-1.24.88-2.62.88-4.07 0-5.18-3.95-9.45-9-9.95M12 19a7 7 0 01-7-7c0-3.53 2.61-6.43 6-6.92V2.05c-5.06.5-9 4.76-9 9.95a10 10 0 0010 10c3.3 0 6.23-1.61 8.05-4.09l-2.6-1.53A6.89 6.89 0 0112 19z"/></svg> </a> Zillion </label> <div class=md-nav__source> <a href=https://github.com/totalhack/zillion/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> totalhack/zillion </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. title="Getting Started" class=md-nav__link> Getting Started </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> API Reference <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="API Reference" data-md-level=1> <label class=md-nav__title for=nav-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> API Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../zillion.configs/ title=zillion.configs class=md-nav__link> zillion.configs </a> </li> <li class=md-nav__item> <a href=../zillion.core/ title=zillion.core class=md-nav__link> zillion.core </a> </li> <li class=md-nav__item> <a href=../zillion.datasource/ title=zillion.datasource class=md-nav__link> zillion.datasource </a> </li> <li class=md-nav__item> <a href=../zillion.field/ title=zillion.field class=md-nav__link> zillion.field </a> </li> <li class=md-nav__item> <a href=../zillion.report/ title=zillion.report class=md-nav__link> zillion.report </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> zillion.sql_utils <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg> </span> </label> <a href=./ title=zillion.sql_utils class="md-nav__link md-nav__link--active"> zillion.sql_utils </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#aggregation_to_sqla_func class=md-nav__link> aggregation_to_sqla_func </a> </li> <li class=md-nav__item> <a href=#check_metadata_url class=md-nav__link> check_metadata_url </a> </li> <li class=md-nav__item> <a href=#column_fullname class=md-nav__link> column_fullname </a> </li> <li class=md-nav__item> <a href=#comment class=md-nav__link> comment </a> </li> <li class=md-nav__item> <a href=#contains_aggregation class=md-nav__link> contains_aggregation </a> </li> <li class=md-nav__item> <a href=#contains_sql_keywords class=md-nav__link> contains_sql_keywords </a> </li> <li class=md-nav__item> <a href=#filter_dialect_schemas class=md-nav__link> filter_dialect_schemas </a> </li> <li class=md-nav__item> <a href=#get_postgres_pid class=md-nav__link> get_postgres_pid </a> </li> <li class=md-nav__item> <a href=#get_postgres_schemas class=md-nav__link> get_postgres_schemas </a> </li> <li class=md-nav__item> <a href=#get_schema_and_table_name class=md-nav__link> get_schema_and_table_name </a> </li> <li class=md-nav__item> <a href=#get_schemas class=md-nav__link> get_schemas </a> </li> <li class=md-nav__item> <a href=#get_sqla_criterion_expr class=md-nav__link> get_sqla_criterion_expr </a> </li> <li class=md-nav__item> <a href=#infer_aggregation_and_rounding class=md-nav__link> infer_aggregation_and_rounding </a> </li> <li class=md-nav__item> <a href=#is_numeric_type class=md-nav__link> is_numeric_type </a> </li> <li class=md-nav__item> <a href=#is_probably_metric class=md-nav__link> is_probably_metric </a> </li> <li class=md-nav__item> <a href=#printexpr class=md-nav__link> printexpr </a> </li> <li class=md-nav__item> <a href=#sqla_compile class=md-nav__link> sqla_compile </a> </li> <li class=md-nav__item> <a href=#to_duckdb_type class=md-nav__link> to_duckdb_type </a> </li> <li class=md-nav__item> <a href=#to_generic_sa_type class=md-nav__link> to_generic_sa_type </a> </li> <li class=md-nav__item> <a href=#to_mysql_type class=md-nav__link> to_mysql_type </a> </li> <li class=md-nav__item> <a href=#to_postgresql_type class=md-nav__link> to_postgresql_type </a> </li> <li class=md-nav__item> <a href=#to_sqlite_type class=md-nav__link> to_sqlite_type </a> </li> <li class=md-nav__item> <a href=#type_string_to_sa_type class=md-nav__link> type_string_to_sa_type </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../zillion.warehouse/ title=zillion.warehouse class=md-nav__link> zillion.warehouse </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../contributing/ title=Contributing class=md-nav__link> Contributing </a> </li> <li class=md-nav__item> <a href=https://github.com/totalhack/zillion title="Star on Github" class=md-nav__link> Star on Github </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#aggregation_to_sqla_func class=md-nav__link> aggregation_to_sqla_func </a> </li> <li class=md-nav__item> <a href=#check_metadata_url class=md-nav__link> check_metadata_url </a> </li> <li class=md-nav__item> <a href=#column_fullname class=md-nav__link> column_fullname </a> </li> <li class=md-nav__item> <a href=#comment class=md-nav__link> comment </a> </li> <li class=md-nav__item> <a href=#contains_aggregation class=md-nav__link> contains_aggregation </a> </li> <li class=md-nav__item> <a href=#contains_sql_keywords class=md-nav__link> contains_sql_keywords </a> </li> <li class=md-nav__item> <a href=#filter_dialect_schemas class=md-nav__link> filter_dialect_schemas </a> </li> <li class=md-nav__item> <a href=#get_postgres_pid class=md-nav__link> get_postgres_pid </a> </li> <li class=md-nav__item> <a href=#get_postgres_schemas class=md-nav__link> get_postgres_schemas </a> </li> <li class=md-nav__item> <a href=#get_schema_and_table_name class=md-nav__link> get_schema_and_table_name </a> </li> <li class=md-nav__item> <a href=#get_schemas class=md-nav__link> get_schemas </a> </li> <li class=md-nav__item> <a href=#get_sqla_criterion_expr class=md-nav__link> get_sqla_criterion_expr </a> </li> <li class=md-nav__item> <a href=#infer_aggregation_and_rounding class=md-nav__link> infer_aggregation_and_rounding </a> </li> <li class=md-nav__item> <a href=#is_numeric_type class=md-nav__link> is_numeric_type </a> </li> <li class=md-nav__item> <a href=#is_probably_metric class=md-nav__link> is_probably_metric </a> </li> <li class=md-nav__item> <a href=#printexpr class=md-nav__link> printexpr </a> </li> <li class=md-nav__item> <a href=#sqla_compile class=md-nav__link> sqla_compile </a> </li> <li class=md-nav__item> <a href=#to_duckdb_type class=md-nav__link> to_duckdb_type </a> </li> <li class=md-nav__item> <a href=#to_generic_sa_type class=md-nav__link> to_generic_sa_type </a> </li> <li class=md-nav__item> <a href=#to_mysql_type class=md-nav__link> to_mysql_type </a> </li> <li class=md-nav__item> <a href=#to_postgresql_type class=md-nav__link> to_postgresql_type </a> </li> <li class=md-nav__item> <a href=#to_sqlite_type class=md-nav__link> to_sqlite_type </a> </li> <li class=md-nav__item> <a href=#type_string_to_sa_type class=md-nav__link> type_string_to_sa_type </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/totalhack/zillion/edit/master/docs/zillion.sql_utils.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=module-zillionsql_utils>Module zillion.sql_utils<a class=headerlink href=#module-zillionsql_utils title="Permanent link">&para;</a></h1> <h2 id=aggregation_to_sqla_func><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L235-L237>aggregation_to_sqla_func</a><a class=headerlink href=#aggregation_to_sqla_func title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>aggregation_to_sqla_func</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>aggregation</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Convert an AggregationType string to a SQLAlchemy function</p></div> </div> <h2 id=check_metadata_url><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L419-L432>check_metadata_url</a><a class=headerlink href=#check_metadata_url title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>check_metadata_url</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>url</em><span class=autodoc-punctuation>, </span><em class=autodoc-param>confirm_exists=False</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Check validity of the metadata URL</p></div> </div> <h2 id=column_fullname><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L295-L315>column_fullname</a><a class=headerlink href=#column_fullname title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>column_fullname</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>column</em><span class=autodoc-punctuation>, </span><em class=autodoc-param>prefix=None</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Get a fully qualified name for a column</p> <p><strong>Parameters:</strong></p> <ul> <li><strong>column</strong> - (<em>SQLAlchemy column</em>) A SQLAlchemy column object to get the full name for</li> <li><strong>prefix</strong> - (<em>str, optional</em>) If specified, a manual prefix to prepend to the output string. This will automatically be separted with a ".".</li> </ul> <p><strong>Returns:</strong></p> <p>(<em>str</em>) - A fully qualified column name. The exact format will vary depending on your SQLAlchemy metadata, but an example would be: schema.table.column</p></div> </div> <h2 id=comment><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L435-L438>comment</a><a class=headerlink href=#comment title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>comment</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>self</em><span class=autodoc-punctuation>, </span><em class=autodoc-param>c</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>See https://github.com/sqlalchemy/sqlalchemy/wiki/CompiledComments</p></div> </div> <h2 id=contains_aggregation><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L108-L138>contains_aggregation</a><a class=headerlink href=#contains_aggregation title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>contains_aggregation</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>sql</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Determine whether a SQL query contains aggregation functions.</p> <p><strong>Warning:</strong></p> <p>This relies on a non-exhaustive list of SQL aggregation functions to look for. This will likely need updating.</p> <p><strong>Parameters:</strong></p> <ul> <li><strong>sql</strong> - (<em>str or sqlparse result</em>) The SQL query to check for aggregation functions</li> </ul> <p><strong>Returns:</strong></p> <p>(<em>bool</em>) - True if the SQL string contains aggregation</p></div> </div> <h2 id=contains_sql_keywords><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L81-L105>contains_sql_keywords</a><a class=headerlink href=#contains_sql_keywords title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>contains_sql_keywords</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>sql</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Determine whether a SQL query contains special SQL keywords (DML, DDL, etc.)</p> <p><strong>Parameters:</strong></p> <ul> <li><strong>sql</strong> - (<em>str or sqlparse result</em>) The SQL query to check for keywords</li> </ul> <p><strong>Returns:</strong></p> <p>(<em>bool</em>) - True if the SQL string contains keywords</p></div> </div> <h2 id=filter_dialect_schemas><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L500-L527>filter_dialect_schemas</a><a class=headerlink href=#filter_dialect_schemas title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>filter_dialect_schemas</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>schemas</em><span class=autodoc-punctuation>, </span><em class=autodoc-param>dialect</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Filter out a set of baseline/system schemas for a dialect</p> <p><strong>Parameters:</strong></p> <ul> <li><strong>schemas</strong> - (<em>list</em>) A list of schema names</li> <li><strong>dialect</strong> - (<em>str</em>) The name of a SQLAlchemy dialect</li> </ul> <p><strong>Returns:</strong></p> <p>(<em>list</em>) - A filtered list of schema names</p></div> </div> <h2 id=get_postgres_pid><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L541-L545>get_postgres_pid</a><a class=headerlink href=#get_postgres_pid title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>get_postgres_pid</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>conn</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Helper to get the PostgreSQL connection PID</p></div> </div> <h2 id=get_postgres_schemas><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L530-L538>get_postgres_schemas</a><a class=headerlink href=#get_postgres_schemas title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>get_postgres_schemas</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>conn</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Helper to list PostgreSQL schemas</p></div> </div> <h2 id=get_schema_and_table_name><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L318-L327>get_schema_and_table_name</a><a class=headerlink href=#get_schema_and_table_name title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>get_schema_and_table_name</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>table</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Extract the schema and table name from a full table name. If the table name is not schema-qualified, return None for the schema name</p></div> </div> <h2 id=get_schemas><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L469-L472>get_schemas</a><a class=headerlink href=#get_schemas title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>get_schemas</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>engine</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Inspect the SQLAlchemy engine to get a list of schemas</p></div> </div> <h2 id=get_sqla_criterion_expr><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L330-L416>get_sqla_criterion_expr</a><a class=headerlink href=#get_sqla_criterion_expr title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>get_sqla_criterion_expr</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>column</em><span class=autodoc-punctuation>, </span><em class=autodoc-param>criterion</em><span class=autodoc-punctuation>, </span><em class=autodoc-param>negate=False</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Create a SQLAlchemy criterion expression</p> <p><strong>Parameters:</strong></p> <ul> <li><strong>column</strong> - (<em>SQLAlchemy column</em>) A SQLAlchemy column object to be used in the expression</li> <li><strong>criterion</strong> - (<em>3-item iterable</em>) A 3-item tuple or list of the format [field, operation, value(s)]. See <code>core.CRITERIA_OPERATIONS</code> for supported operations. The value item may take on different formats depending on the operation. In most cases passing an iterable will result in multiple criteria of that operation being formed. For example, ("my_field", "=", [1,2,3]) would logically or 3 conditions of equality to the 3 values in the list. The "between" operations expect each value to be a 2-item iterable representing the lower and upper bound of the criterion.</li> <li><strong>negate</strong> - (<em>bool, optional</em>) Negate the expression</li> </ul> <p><strong>Returns:</strong></p> <p>(<em>SQLAlchemy expression</em>) - A SQLALchemy expression representing the criterion</p> <p><strong>Notes:</strong></p> <p>Postgresql "like" is case sensitive, but mysql "like" is not. Postgresql also supports "ilike" to specify case insensitive, so one option is to look at the dialect to determine the function, but that is not supported yet.</p></div> </div> <h2 id=infer_aggregation_and_rounding><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L198-L232>infer_aggregation_and_rounding</a><a class=headerlink href=#infer_aggregation_and_rounding title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>infer_aggregation_and_rounding</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>column</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Infer the aggregation and rounding settings based on the column type. This is just a rough / best guess based on the column type, precision and rounding settings.</p> <p><strong>Parameters:</strong></p> <ul> <li><strong>column</strong> - (<em>SQLAlchemy column</em>) The column to analyze</li> </ul> <p><strong>Returns:</strong></p> <p>(<em>AggregationType, int</em>) - A 2-item tuple of the aggregation type and rounding to use</p></div> </div> <h2 id=is_numeric_type><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L240-L245>is_numeric_type</a><a class=headerlink href=#is_numeric_type title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>is_numeric_type</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>type</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Determine if this is a numeric SQLAlchemy type</p></div> </div> <h2 id=is_probably_metric><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L248-L272>is_probably_metric</a><a class=headerlink href=#is_probably_metric title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>is_probably_metric</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>column</em><span class=autodoc-punctuation>, </span><em class=autodoc-param>formula=None</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Determine if a column is probably a metric. This is used when trying to automatically init/reflect a datasource and determine the field types for columns. The logic is very coarse, and should not be relied on for more than quick/convenient use cases.</p> <p><strong>Parameters:</strong></p> <ul> <li><strong>column</strong> - (<em>SQLAlchemy column</em>) The column to analyze</li> <li><strong>formula</strong> - (<em>str, optional</em>) A formula to calculate the column</li> </ul> <p><strong>Returns:</strong></p> <p>(<em>bool</em>) - True if the column is probably a metric</p></div> </div> <h2 id=printexpr><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L290-L292>printexpr</a><a class=headerlink href=#printexpr title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>printexpr</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>expr</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Print a SQLAlchemy expression</p></div> </div> <h2 id=sqla_compile><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L275-L287>sqla_compile</a><a class=headerlink href=#sqla_compile title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>sqla_compile</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>expr</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Compile a SQL expression</p> <p><strong>Parameters:</strong></p> <ul> <li><strong>expr</strong> - (<em>SQLAlchemy expression</em>) The SQLAlchemy expression to compile</li> </ul> <p><strong>Returns:</strong></p> <p>(<em>str</em>) - The compiled expression string</p></div> </div> <h2 id=to_duckdb_type><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L493-L497>to_duckdb_type</a><a class=headerlink href=#to_duckdb_type title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>to_duckdb_type</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>type</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Compile into a DuckDB SQLAlchemy type</p></div> </div> <h2 id=to_generic_sa_type><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L180-L195>to_generic_sa_type</a><a class=headerlink href=#to_generic_sa_type title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>to_generic_sa_type</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>type</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Return a generic SQLAlchemy type object from a type that may be dialect- specific. This will attempt to preserve common type settings such as specified field length, scale, and precision. On error it will fall back to trying to init the generic type with no params.</p></div> </div> <h2 id=to_mysql_type><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L478-L480>to_mysql_type</a><a class=headerlink href=#to_mysql_type title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>to_mysql_type</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>type</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Compile into a MySQL SQLAlchemy type</p></div> </div> <h2 id=to_postgresql_type><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L483-L485>to_postgresql_type</a><a class=headerlink href=#to_postgresql_type title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>to_postgresql_type</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>type</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Compile into a PostgreSQL SQLAlchemy type</p></div> </div> <h2 id=to_sqlite_type><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L488-L490>to_sqlite_type</a><a class=headerlink href=#to_sqlite_type title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>to_sqlite_type</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>type</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Compile into a SQLite SQLAlchemy type</p></div> </div> <h2 id=type_string_to_sa_type><a href=https://github.com/totalhack/zillion/blob/master/zillion/sql_utils.py#L141-L177>type_string_to_sa_type</a><a class=headerlink href=#type_string_to_sa_type title="Permanent link">&para;</a></h2> <div class=autodoc> <div class=autodoc-signature><code>zillion.sql_utils.<strong>type_string_to_sa_type</strong></code><span class=autodoc-punctuation>(</span><em class=autodoc-param>type_string</em><span class=autodoc-punctuation>)</span></div> <div class=autodoc-docstring><p>Convert a field type string to a SQLAlchemy type. The type string will be evaluated as a python statement or class name to init from the SQLAlchemy top level module. Dialect-specific SQLAlchemy types are not currently supported.</p> <p><strong>Parameters:</strong></p> <ul> <li><strong>type_string</strong> - (<em>str</em>) A string representing a SQLAlchemy type, such as "Integer", or "String(32)". This does a case-insensitive search and will return the first matching SQLAlchemy type.</li> </ul> <p><strong>Returns:</strong></p> <p>(<em>SQLAlchemy type object</em>) - An init'd SQLAlchemy type object</p></div> </div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../zillion.report/ title=zillion.report class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> zillion.report </div> </div> </a> <a href=../zillion.warehouse/ title=zillion.warehouse class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> zillion.warehouse </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2020 - present @totalhack </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/totalhack/zillion target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../assets/javascripts/vendor.d710d30a.min.js></script> <script src=../assets/javascripts/bundle.5f27aba8.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>