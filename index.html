<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Make sense of it all."><link href=https://totalhack.github.io/zillion/ rel=canonical><meta name=author content=totalhack><link rel="shortcut icon" href=images/chart-donut.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-5.2.1"><title>Zillion</title><link rel=stylesheet href=assets/stylesheets/main.71dfd922.min.css><link rel=stylesheet href=assets/stylesheets/palette.616af814.min.css><meta name=theme-color content=#546e7a><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=stylesheet href=css/extra.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=blue-grey data-md-color-accent=light-blue> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#introduction class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=https://totalhack.github.io/zillion/ title=Zillion class="md-header-nav__button md-logo" aria-label=Zillion> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 2.05v3.03c3.39.49 6 3.39 6 6.92 0 .9-.18 1.75-.5 2.54l2.62 1.53c.56-1.24.88-2.62.88-4.07 0-5.18-3.95-9.45-9-9.95M12 19a7 7 0 01-7-7c0-3.53 2.61-6.43 6-6.92V2.05c-5.06.5-9 4.76-9 9.95a10 10 0 0010 10c3.3 0 6.23-1.61 8.05-4.09l-2.6-1.53A6.89 6.89 0 0112 19z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Zillion </span> <span class="md-header-nav__topic md-ellipsis"> Getting Started </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/totalhack/zillion/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> totalhack/zillion </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://totalhack.github.io/zillion/ title=Zillion class="md-nav__button md-logo" aria-label=Zillion> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 2.05v3.03c3.39.49 6 3.39 6 6.92 0 .9-.18 1.75-.5 2.54l2.62 1.53c.56-1.24.88-2.62.88-4.07 0-5.18-3.95-9.45-9-9.95M12 19a7 7 0 01-7-7c0-3.53 2.61-6.43 6-6.92V2.05c-5.06.5-9 4.76-9 9.95a10 10 0 0010 10c3.3 0 6.23-1.61 8.05-4.09l-2.6-1.53A6.89 6.89 0 0112 19z"/></svg> </a> Zillion </label> <div class=md-nav__source> <a href=https://github.com/totalhack/zillion/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> totalhack/zillion </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Getting Started <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg> </span> </label> <a href=. title="Getting Started" class="md-nav__link md-nav__link--active"> Getting Started </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=#installation class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=#primer class=md-nav__link> Primer </a> <nav class=md-nav aria-label=Primer> <ul class=md-nav__list> <li class=md-nav__item> <a href=#metrics-and-dimensions class=md-nav__link> Metrics and Dimensions </a> </li> <li class=md-nav__item> <a href=#warehouse-theory class=md-nav__link> Warehouse Theory </a> </li> <li class=md-nav__item> <a href=#query-layers class=md-nav__link> Query Layers </a> </li> <li class=md-nav__item> <a href=#warehouse-creation class=md-nav__link> Warehouse Creation </a> </li> <li class=md-nav__item> <a href=#executing-reports class=md-nav__link> Executing Reports </a> </li> <li class=md-nav__item> <a href=#natural-language-querying class=md-nav__link> Natural Language Querying </a> </li> <li class=md-nav__item> <a href=#zillion-configuration class=md-nav__link> Zillion Configuration </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#example-sales-analytics class=md-nav__link> Example - Sales Analytics </a> <nav class=md-nav aria-label="Example - Sales Analytics"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#warehouse-configuration class=md-nav__link> Warehouse Configuration </a> </li> <li class=md-nav__item> <a href=#reports class=md-nav__link> Reports </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#advanced-topics class=md-nav__link> Advanced Topics </a> <nav class=md-nav aria-label="Advanced Topics"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#formula-metrics class=md-nav__link> Formula Metrics </a> </li> <li class=md-nav__item> <a href=#divisor-metrics class=md-nav__link> Divisor Metrics </a> </li> <li class=md-nav__item> <a href=#formula-dimensions class=md-nav__link> Formula Dimensions </a> </li> <li class=md-nav__item> <a href=#datasource-formulas class=md-nav__link> DataSource Formulas </a> </li> <li class=md-nav__item> <a href=#type-conversions class=md-nav__link> Type Conversions </a> </li> <li class=md-nav__item> <a href=#config-variables class=md-nav__link> Config Variables </a> </li> <li class=md-nav__item> <a href=#datasource-priority class=md-nav__link> DataSource Priority </a> </li> <li class=md-nav__item> <a href=#ad-hoc-metrics class=md-nav__link> Ad Hoc Metrics </a> </li> <li class=md-nav__item> <a href=#ad-hoc-dimensions class=md-nav__link> Ad Hoc Dimensions </a> </li> <li class=md-nav__item> <a href=#ad-hoc-tables class=md-nav__link> Ad Hoc Tables </a> </li> <li class=md-nav__item> <a href=#technicals class=md-nav__link> Technicals </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#supported-datasources class=md-nav__link> Supported DataSources </a> </li> <li class=md-nav__item> <a href=#multiprocess-considerations class=md-nav__link> Multiprocess Considerations </a> </li> <li class=md-nav__item> <a href=#related-projects class=md-nav__link> Related Projects </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> API Reference <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="API Reference" data-md-level=1> <label class=md-nav__title for=nav-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> API Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=zillion.configs/ title=zillion.configs class=md-nav__link> zillion.configs </a> </li> <li class=md-nav__item> <a href=zillion.core/ title=zillion.core class=md-nav__link> zillion.core </a> </li> <li class=md-nav__item> <a href=zillion.datasource/ title=zillion.datasource class=md-nav__link> zillion.datasource </a> </li> <li class=md-nav__item> <a href=zillion.field/ title=zillion.field class=md-nav__link> zillion.field </a> </li> <li class=md-nav__item> <a href=zillion.report/ title=zillion.report class=md-nav__link> zillion.report </a> </li> <li class=md-nav__item> <a href=zillion.sql_utils/ title=zillion.sql_utils class=md-nav__link> zillion.sql_utils </a> </li> <li class=md-nav__item> <a href=zillion.warehouse/ title=zillion.warehouse class=md-nav__link> zillion.warehouse </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=contributing/ title=Contributing class=md-nav__link> Contributing </a> </li> <li class=md-nav__item> <a href=https://github.com/totalhack/zillion title="Star on Github" class=md-nav__link> Star on Github </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=#installation class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=#primer class=md-nav__link> Primer </a> <nav class=md-nav aria-label=Primer> <ul class=md-nav__list> <li class=md-nav__item> <a href=#metrics-and-dimensions class=md-nav__link> Metrics and Dimensions </a> </li> <li class=md-nav__item> <a href=#warehouse-theory class=md-nav__link> Warehouse Theory </a> </li> <li class=md-nav__item> <a href=#query-layers class=md-nav__link> Query Layers </a> </li> <li class=md-nav__item> <a href=#warehouse-creation class=md-nav__link> Warehouse Creation </a> </li> <li class=md-nav__item> <a href=#executing-reports class=md-nav__link> Executing Reports </a> </li> <li class=md-nav__item> <a href=#natural-language-querying class=md-nav__link> Natural Language Querying </a> </li> <li class=md-nav__item> <a href=#zillion-configuration class=md-nav__link> Zillion Configuration </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#example-sales-analytics class=md-nav__link> Example - Sales Analytics </a> <nav class=md-nav aria-label="Example - Sales Analytics"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#warehouse-configuration class=md-nav__link> Warehouse Configuration </a> </li> <li class=md-nav__item> <a href=#reports class=md-nav__link> Reports </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#advanced-topics class=md-nav__link> Advanced Topics </a> <nav class=md-nav aria-label="Advanced Topics"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#formula-metrics class=md-nav__link> Formula Metrics </a> </li> <li class=md-nav__item> <a href=#divisor-metrics class=md-nav__link> Divisor Metrics </a> </li> <li class=md-nav__item> <a href=#formula-dimensions class=md-nav__link> Formula Dimensions </a> </li> <li class=md-nav__item> <a href=#datasource-formulas class=md-nav__link> DataSource Formulas </a> </li> <li class=md-nav__item> <a href=#type-conversions class=md-nav__link> Type Conversions </a> </li> <li class=md-nav__item> <a href=#config-variables class=md-nav__link> Config Variables </a> </li> <li class=md-nav__item> <a href=#datasource-priority class=md-nav__link> DataSource Priority </a> </li> <li class=md-nav__item> <a href=#ad-hoc-metrics class=md-nav__link> Ad Hoc Metrics </a> </li> <li class=md-nav__item> <a href=#ad-hoc-dimensions class=md-nav__link> Ad Hoc Dimensions </a> </li> <li class=md-nav__item> <a href=#ad-hoc-tables class=md-nav__link> Ad Hoc Tables </a> </li> <li class=md-nav__item> <a href=#technicals class=md-nav__link> Technicals </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#supported-datasources class=md-nav__link> Supported DataSources </a> </li> <li class=md-nav__item> <a href=#multiprocess-considerations class=md-nav__link> Multiprocess Considerations </a> </li> <li class=md-nav__item> <a href=#related-projects class=md-nav__link> Related Projects </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/totalhack/zillion/edit/master/docs/index.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>Getting Started</h1> <p><a href=https://shields.io/ ><img alt="Generic badge" src=https://img.shields.io/badge/Status-Alpha-yellow.svg></a> <a href=https://github.com/psf/black><img alt="Code style: black" src=https://img.shields.io/badge/code%20style-black-000000.svg></a> <a href=https://opensource.org/licenses/LGPL-3.0><img alt="License: LGPLv3" src=https://img.shields.io/badge/License-LGPLv3-blue.svg></a> <img alt="Python 3" src=https://img.shields.io/badge/python-3-blue.svg> <a href=https://pepy.tech/project/zillion><img alt=Downloads src=https://pepy.tech/badge/zillion></a></p> <h2 id=introduction><strong>Introduction</strong><a class=headerlink href=#introduction title="Permanent link">&para;</a></h2> <p><code>Zillion</code> is a data modeling and analytics tool that allows combining and analyzing data from multiple datasources through a simple API. It writes SQL so you don't have to, and it easily bolts onto existing database infrastructure via SQLAlchemy. The <code>Zillion</code> NLP extension has experimental support for AI-powered natural language querying and warehouse configuration.</p> <p>With <code>Zillion</code> you can:</p> <ul> <li>Define a warehouse that contains a variety of SQL and/or file-like datasources</li> <li>Define or reflect metrics, dimensions, and relationships in your data</li> <li>Run multi-datasource reports and combine the results in a DataFrame</li> <li>Flexibly aggregate your data with multi-level rollups and table pivots</li> <li>Customize or combine fields with formulas</li> <li>Apply technical transformations including rolling, cumulative, and rank statistics</li> <li>Apply automatic type conversions - i.e. get a "year" dimension for free from a "date" column</li> <li>Save and share report specifications</li> <li>Utilize ad hoc or public datasources, tables, and fields to enrich reports</li> <li>Query your warehouse with natural language (NLP extension)</li> <li>Leverage AI to bootstrap your warehouse configurations (NLP extension)</li> </ul> <hr> <p><a name=installation></a></p> <h2 id=installation><strong>Installation</strong><a class=headerlink href=#installation title="Permanent link">&para;</a></h2> <blockquote> <p><strong>Warning</strong>: This project is in an alpha state and is subject to change. Please test carefully for production usage and report any issues.</p> </blockquote> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code>$<span style="color: #f8f8f2"> </span>pip<span style="color: #f8f8f2"> </span>install<span style="color: #f8f8f2"> </span>zillion

or

$<span style="color: #f8f8f2"> </span>pip<span style="color: #f8f8f2"> </span>install<span style="color: #f8f8f2"> </span>zillion<span style="color: #f92672">[</span>nlp<span style="color: #f92672">]</span>
</code></pre></div> <hr> <p><a name=primer></a></p> <h2 id=primer><strong>Primer</strong><a class=headerlink href=#primer title="Permanent link">&para;</a></h2> <p>The following is meant to give a quick overview of some theory and nomenclature used in data warehousing with <code>Zillion</code> which will be useful if you are newer to this area. You can also skip below for a usage <a href=#example-sales-analytics>example</a> or warehouse/datasource creation <a href=#warehouse-creation>quickstart</a> options.</p> <p>In short: <code>Zillion</code> writes SQL for you and makes data accessible through a very simple API:</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f8f8f2">result</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">warehouse</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">execute(</span>
    <span style="color: #f8f8f2">metrics</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;revenue&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;leads&quot;</span><span style="color: #f8f8f2">],</span>
    <span style="color: #f8f8f2">dimensions</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;date&quot;</span><span style="color: #f8f8f2">],</span>
    <span style="color: #f8f8f2">criteria</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span>
        <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;date&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;&gt;&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;2020-01-01&quot;</span><span style="color: #f8f8f2">),</span>
        <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;partner&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;=&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;Partner A&quot;</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">]</span>
<span style="color: #f8f8f2">)</span>
</code></pre></div> <p><a name=metrics-and-dimensions></a></p> <h3 id=metrics-and-dimensions><strong>Metrics and Dimensions</strong><a class=headerlink href=#metrics-and-dimensions title="Permanent link">&para;</a></h3> <p>In <code>Zillion</code> there are two main types of <code>Fields</code> that will be used in your report requests:</p> <ol> <li><code>Dimensions</code>: attributes of data used for labelling, grouping, and filtering</li> <li><code>Metrics</code>: facts and measures that may be broken down along dimensions</li> </ol> <p>A <code>Field</code> encapsulates the concept of a column in your data. For example, you may have a <code>Field</code> called "revenue". That <code>Field</code> may occur across several datasources or possibly in multiple tables within a single datasource. <code>Zillion</code> understands that all of those columns represent the same concept, and it can try to use any of them to satisfy reports requesting "revenue".</p> <p>Likewise there are two main types of tables used to structure your warehouse:</p> <ol> <li><code>Dimension Tables</code>: reference/attribute tables containing only related dimensions</li> <li><code>Metric Tables</code>: fact tables that may contain metrics and some related dimensions/attributes</li> </ol> <p>Dimension tables are often static or slowly growing in terms of row count and contain attributes tied to a primary key. Some common examples would be lists of US Zip Codes or company/partner directories.</p> <p>Metric tables are generally more transactional in nature. Some common examples would be records for web requests, ecommerce sales, or stock market price history.</p> <p><a name=warehouse-theory></a></p> <h3 id=warehouse-theory><strong>Warehouse Theory</strong><a class=headerlink href=#warehouse-theory title="Permanent link">&para;</a></h3> <p>If you really want to go deep on dimensional modeling and the drill-across querying technique <code>Zillion</code> employs, I recommend reading Ralph Kimball's <a href=https://www.kimballgroup.com/data-warehouse-business-intelligence-resources/books/data-warehouse-dw-toolkit/ >book</a> on data warehousing.</p> <p>To summarize, <a href=https://www.kimballgroup.com/data-warehouse-business-intelligence-resources/kimball-techniques/dimensional-modeling-techniques/drilling-across/ >drill-across querying</a> forms one or more queries to satisfy a report request for <code>metrics</code> that may exist across multiple datasources and/or tables at a particular <code>dimension</code> grain.</p> <p><code>Zillion</code> supports flexible warehouse setups such as <a href=https://en.wikipedia.org/wiki/Snowflake_schema>snowflake</a> or <a href=https://en.wikipedia.org/wiki/Star_schema>star</a> schemas, though it isn't picky about it. You can specify table relationships through a parent-child lineage, and <code>Zillion</code> can also infer acceptable joins based on the presence of dimension table primary keys. <code>Zillion</code> does not support many-to-many relationships at this time, though most analytics-focused scenarios should be able to work around that by adding views to the model if needed.</p> <p><a name=query-layers></a></p> <h3 id=query-layers><strong>Query Layers</strong><a class=headerlink href=#query-layers title="Permanent link">&para;</a></h3> <p><code>Zillion</code> reports can be thought of as running in two layers:</p> <ol> <li><code>DataSource Layer</code>: SQL queries against the warehouse's datasources</li> <li><code>Combined Layer</code>: A final SQL query against the combined data from the DataSource Layer</li> </ol> <p>The Combined Layer is just another SQL database (in-memory SQLite by default) that is used to tie the datasource data together and apply a few additional features such as rollups, row filters, row limits, sorting, pivots, and technical computations.</p> <p><a name=warehouse-creation></a></p> <h3 id=warehouse-creation><strong>Warehouse Creation</strong><a class=headerlink href=#warehouse-creation title="Permanent link">&para;</a></h3> <p>There are multiple ways to quickly initialize a warehouse from a local or remote file:</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #75715e"># Path/link to a CSV, XLSX, XLS, JSON, HTML, or Google Sheet</span>
<span style="color: #75715e"># This builds a single-table Warehouse for quick/ad-hoc analysis.</span>
<span style="color: #f8f8f2">url</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;https://raw.githubusercontent.com/totalhack/zillion/master/tests/dma_zip.xlsx&quot;</span>
<span style="color: #f8f8f2">wh</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Warehouse</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">from_data_file(url,</span> <span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;Zip_Code&quot;</span><span style="color: #f8f8f2">])</span> <span style="color: #75715e"># Second arg is primary key</span>

<span style="color: #75715e"># Path/link to a sqlite database</span>
<span style="color: #75715e"># This can build a single or multi-table Warehouse</span>
<span style="color: #f8f8f2">url</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;https://github.com/totalhack/zillion/blob/master/tests/testdb1?raw=true&quot;</span>
<span style="color: #f8f8f2">wh</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Warehouse</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">from_db_file(url)</span>

<span style="color: #75715e"># Path/link to a WarehouseConfigSchema (or pass a dict)</span>
<span style="color: #75715e"># This is the recommended production approach!</span>
<span style="color: #f8f8f2">config</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;https://raw.githubusercontent.com/totalhack/zillion/master/examples/example_wh_config.json&quot;</span>
<span style="color: #f8f8f2">wh</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Warehouse(config</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">config)</span>
</code></pre></div> <p>Zillion also provides a helper script to boostrap a DataSource configuration file for an existing database. See <code>zillion.scripts.bootstrap_datasource_config.py</code>. The bootstrap script requires a connection/database url and output file as arguments. See <code>--help</code> output for more options, including the optional <code>--nlp</code> flag that leverages OpenAI to infer configuration information such as column types, table types, and table relationships. The NLP feature requires the NLP extension to be installed as well as the following set in your <code>Zillion</code> config file:</p> <ul> <li>OPENAI_MODEL</li> <li>OPENAI_API_KEY</li> </ul> <p><a name=executing-reports></a></p> <h3 id=executing-reports><strong>Executing Reports</strong><a class=headerlink href=#executing-reports title="Permanent link">&para;</a></h3> <p>The main purpose of <code>Zillion</code> is to execute reports against a <code>Warehouse</code>. At a high level you will be crafting reports as follows:</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f8f8f2">result</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">warehouse</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">execute(</span>
    <span style="color: #f8f8f2">metrics</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;revenue&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;leads&quot;</span><span style="color: #f8f8f2">],</span>
    <span style="color: #f8f8f2">dimensions</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;date&quot;</span><span style="color: #f8f8f2">],</span>
    <span style="color: #f8f8f2">criteria</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span>
        <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;date&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;&gt;&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;2020-01-01&quot;</span><span style="color: #f8f8f2">),</span>
        <span style="color: #f8f8f2">(</span><span style="color: #e6db74">&quot;partner&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;=&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;Partner A&quot;</span><span style="color: #f8f8f2">)</span>
    <span style="color: #f8f8f2">]</span>
<span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">print(result</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">df)</span> <span style="color: #75715e"># Pandas DataFrame</span>
</code></pre></div> <p>When comparing to writing SQL, it's helpful to think of the dimensions as the target columns of a <strong>group by</strong> SQL statement. Think of the metrics as the columns you are <strong>aggregating</strong>. Think of the criteria as the <strong>where clause</strong>. Your criteria are applied in the DataSource Layer SQL queries.</p> <p>The <code>ReportResult</code> has a Pandas DataFrame with the dimensions as the index and the metrics as the columns.</p> <p>A <code>Report</code> is said to have a <code>grain</code>, which defines the dimensions each metric must be able to join to in order to satisfy the <code>Report</code> requirements. The <code>grain</code> is a combination of <strong>all</strong> dimensions, including those referenced in criteria or in metric formulas. In the example above, the <code>grain</code> would be <code>{date, partner}</code>. Both "revenue" and "leads" must be able to join to those dimensions for this report to be possible.</p> <p>These concepts can take time to sink in and obviously vary with the specifics of your data model, but you will become more familiar with them as you start putting together reports against your data warehouses.</p> <p><a name=natural-language-querying></a></p> <h3 id=natural-language-querying><strong>Natural Language Querying</strong><a class=headerlink href=#natural-language-querying title="Permanent link">&para;</a></h3> <p>With the NLP extension <code>Zillion</code> has experimental support for natural language querying of your data warehouse. For example:</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f8f8f2">result</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">warehouse</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">execute_text(</span><span style="color: #e6db74">&quot;revenue and leads by date last month&quot;</span><span style="color: #f8f8f2">)</span>
<span style="color: #f8f8f2">print(result</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">df)</span> <span style="color: #75715e"># Pandas DataFrame</span>
</code></pre></div> <p>This NLP feature require a running instance of Qdrant (vector database) and the following values set in your <code>Zillion</code> config file:</p> <ul> <li>QDRANT_HOST</li> <li>OPENAI_API_KEY</li> </ul> <p>Embeddings will be produced and stored in both Qdrant and a local cache. The vector database will be initialized the first time you try to use this by analyzing all fields in your warehouse. An example docker file to run Qdrant is provided in the root of this repo.</p> <p>You have some control over how fields get embedded. Namely in the configuration for any field you can choose whether to exclude a field from embeddings or override which embeddings map to that field. All fields are included by default. The following example would exclude the <code>net_revenue</code> field from being embedded and map <code>revenue</code> metric requests to the <code>gross_revenue</code> field. This type of control becomes useful as your data model gets more complex and you want to guide the NLP logic in cases where it could confuse similarly named fields.</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f8f8f2">{</span>
<span style="color: #f8f8f2">    </span><span style="color: #e6db74">&quot;name&quot;</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&quot;gross_revenue&quot;</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    </span><span style="color: #e6db74">&quot;type&quot;</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&quot;numeric(10,2)&quot;</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    </span><span style="color: #e6db74">&quot;aggregation&quot;</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&quot;sum&quot;</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    </span><span style="color: #e6db74">&quot;rounding&quot;</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    </span><span style="color: #e6db74">&quot;meta&quot;</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> {</span>
<span style="color: #f8f8f2">        </span><span style="color: #e6db74">&quot;nlp&quot;</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> {</span>
<span style="color: #f8f8f2">            </span><span style="color: #75715e">// enabled defaults to true</span>
<span style="color: #f8f8f2">            </span><span style="color: #e6db74">&quot;embedding_text&quot;</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&quot;revenue&quot;</span><span style="color: #f8f8f2"> </span><span style="color: #75715e">// str or list of str</span>
<span style="color: #f8f8f2">        }</span>
<span style="color: #f8f8f2">    }</span>
<span style="color: #f8f8f2">},</span>
<span style="color: #f8f8f2">{</span>
<span style="color: #f8f8f2">    </span><span style="color: #e6db74">&quot;name&quot;</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&quot;net_revenue&quot;</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    </span><span style="color: #e6db74">&quot;type&quot;</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&quot;numeric(10,2)&quot;</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    </span><span style="color: #e6db74">&quot;aggregation&quot;</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #e6db74">&quot;sum&quot;</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    </span><span style="color: #e6db74">&quot;rounding&quot;</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    </span><span style="color: #e6db74">&quot;meta&quot;</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> {</span>
<span style="color: #f8f8f2">        </span><span style="color: #e6db74">&quot;nlp&quot;</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> {</span>
<span style="color: #f8f8f2">            </span><span style="color: #e6db74">&quot;enabled&quot;</span><span style="color: #f92672">:</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">false</span>
<span style="color: #f8f8f2">        }</span>
<span style="color: #f8f8f2">    }</span>
<span style="color: #f8f8f2">},</span>
</code></pre></div> <blockquote> <p><em>Note:</em> This feature is in its infancy. It's usefulness will depend on the quality of both the input query and your data model (i.e. good field names).</p> </blockquote> <p><a name=zillion-configuration></a></p> <h3 id=zillion-configuration><strong>Zillion Configuration</strong><a class=headerlink href=#zillion-configuration title="Permanent link">&para;</a></h3> <p>In addition to configuring the structure of your <code>Warehouse</code>, which will be discussed further below, <code>Zillion</code> has a global configuration to control some basic settings. The <code>ZILLION_CONFIG</code> environment var can point to a yaml config file. See <code>examples/sample_config.yaml</code> for more details on what values can be set. Environment vars prefixed with ZILLION_ can override config settings (i.e. ZILLION_DB_URL will override DB_URL).</p> <p>The database used to store Zillion report specs can be configured by setting the DB_URL value in your <code>Zillion</code> config to a valid database connection string. By default a SQLite DB in /tmp is used.</p> <hr> <p><a name=example-sales-analytics></a></p> <h2 id=example-sales-analytics><strong>Example - Sales Analytics</strong><a class=headerlink href=#example-sales-analytics title="Permanent link">&para;</a></h2> <p>Below we will walk through a simple hypothetical sales data model that demonstrates basic <code>DataSource</code> and <code>Warehouse</code> configuration and then shows some sample <a href=#example-reports>reports</a>. The data is a simple SQLite database that is part of the <code>Zillion</code> test code. For reference, the schema is as follows:</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #66d9ef">CREATE</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">TABLE</span><span style="color: #f8f8f2"> partners (</span>
<span style="color: #f8f8f2">  id INTEGER </span><span style="color: #66d9ef">PRIMARY</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">KEY</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">  name VARCHAR </span><span style="color: #66d9ef">NOT</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">NULL</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">UNIQUE</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">  created_at </span><span style="color: #66d9ef">TIMESTAMP</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">DEFAULT</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">CURRENT_TIMESTAMP</span>
<span style="color: #f8f8f2">);</span>

<span style="color: #66d9ef">CREATE</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">TABLE</span><span style="color: #f8f8f2"> campaigns (</span>
<span style="color: #f8f8f2">  id INTEGER </span><span style="color: #66d9ef">PRIMARY</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">KEY</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">  name VARCHAR </span><span style="color: #66d9ef">NOT</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">NULL</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">UNIQUE</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">  category VARCHAR </span><span style="color: #66d9ef">NOT</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">NULL</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">  partner_id INTEGER </span><span style="color: #66d9ef">NOT</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">NULL</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">  created_at </span><span style="color: #66d9ef">TIMESTAMP</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">DEFAULT</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">CURRENT_TIMESTAMP</span>
<span style="color: #f8f8f2">);</span>

<span style="color: #66d9ef">CREATE</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">TABLE</span><span style="color: #f8f8f2"> leads (</span>
<span style="color: #f8f8f2">  id INTEGER </span><span style="color: #66d9ef">PRIMARY</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">KEY</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">  name VARCHAR </span><span style="color: #66d9ef">NOT</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">NULL</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">  campaign_id INTEGER </span><span style="color: #66d9ef">NOT</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">NULL</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">  created_at </span><span style="color: #66d9ef">TIMESTAMP</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">DEFAULT</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">CURRENT_TIMESTAMP</span>
<span style="color: #f8f8f2">);</span>

<span style="color: #66d9ef">CREATE</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">TABLE</span><span style="color: #f8f8f2"> sales (</span>
<span style="color: #f8f8f2">  id INTEGER </span><span style="color: #66d9ef">PRIMARY</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">KEY</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">  item VARCHAR </span><span style="color: #66d9ef">NOT</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">NULL</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">  quantity INTEGER </span><span style="color: #66d9ef">NOT</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">NULL</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">  revenue DECIMAL(</span><span style="color: #ae81ff">10</span><span style="color: #f8f8f2">, </span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">),</span>
<span style="color: #f8f8f2">  lead_id INTEGER </span><span style="color: #66d9ef">NOT</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">NULL</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">  created_at </span><span style="color: #66d9ef">TIMESTAMP</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">DEFAULT</span><span style="color: #f8f8f2"> </span><span style="color: #66d9ef">CURRENT_TIMESTAMP</span>
<span style="color: #f8f8f2">);</span>
</code></pre></div> <p><a name=example-warehouse-config></a></p> <h3 id=warehouse-configuration><strong>Warehouse Configuration</strong><a class=headerlink href=#warehouse-configuration title="Permanent link">&para;</a></h3> <p>A <code>Warehouse</code> may be created from a from a JSON or YAML configuration that defines its fields, datasources, and tables. The code below shows how it can be done in as little as one line of code if you have a pointer to a JSON/YAML <code>Warehouse</code> config.</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f92672">from</span> <span style="color: #f8f8f2">zillion</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">Warehouse</span>

<span style="color: #f8f8f2">wh</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Warehouse(config</span><span style="color: #f92672">=</span><span style="color: #e6db74">&quot;https://raw.githubusercontent.com/totalhack/zillion/master/examples/example_wh_config.json&quot;</span><span style="color: #f8f8f2">)</span>
</code></pre></div> <p>This example config uses a <code>data_url</code> in its <code>DataSource</code> <code>connect</code> info that tells <code>Zillion</code> to dynamically download that data and connect to it as a SQLite database. This is useful for quick examples or analysis, though in most scenarios you would put a connection string to an existing database like you see <a href=https://raw.githubusercontent.com/totalhack/zillion/master/tests/test_mysql_ds_config.json>here</a></p> <p>The basics of <code>Zillion's</code> warehouse configuration structure are as follows:</p> <p>A <code>Warehouse</code> config has the following main sections:</p> <ul> <li><code>metrics</code>: optional list of metric configs for global metrics</li> <li><code>dimensions</code>: optional list of dimension configs for global dimensions</li> <li><code>datasources</code>: mapping of datasource names to datasource configs or config URLs</li> </ul> <p>A <code>DataSource</code> config has the following main sections:</p> <ul> <li><code>connect</code>: database connection url or dict of connect params</li> <li><code>metrics</code>: optional list of metric configs specific to this datasource</li> <li><code>dimensions</code>: optional list of dimension configs specific to this datasource</li> <li><code>tables</code>: mapping of table names to table configs or config URLs</li> </ul> <blockquote> <p>Tip: datasource and table configs may also be replaced with a URL that points to a local or remote config file.</p> </blockquote> <p>In this example all four tables in our database are included in the config, two as dimension tables and two as metric tables. The tables are linked through a parent-&gt;child relationship: partners to campaigns, and leads to sales. Some tables also utilize the <code>create_fields</code> flag to automatically create <code>Fields</code> on the datasource from column definitions. Other metrics and dimensions are defined explicitly.</p> <p>To view the structure of this <code>Warehouse</code> after init you can use the <code>print_info</code> method which shows all metrics, dimensions, tables, and columns that are part of your data warehouse:</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f8f8f2">wh</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">print_info()</span> <span style="color: #75715e"># Formatted print of the Warehouse structure</span>
</code></pre></div> <p>For a deeper dive of the config schema please see the full <a href=https://totalhack.github.io/zillion/zillion.configs/ >docs</a>.</p> <p><a name=example-reports></a></p> <h3 id=reports><strong>Reports</strong><a class=headerlink href=#reports title="Permanent link">&para;</a></h3> <p><strong>Example:</strong> Get sales, leads, and revenue by partner:</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f8f8f2">result</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">wh</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">execute(</span>
    <span style="color: #f8f8f2">metrics</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;sales&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;leads&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;revenue&quot;</span><span style="color: #f8f8f2">],</span>
    <span style="color: #f8f8f2">dimensions</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;partner_name&quot;</span><span style="color: #f8f8f2">]</span>
<span style="color: #f8f8f2">)</span>

<span style="color: #f8f8f2">print(result</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">df)</span>
<span style="color: #e6db74">&quot;&quot;&quot;</span>
<span style="color: #e6db74">              sales  leads  revenue</span>
<span style="color: #e6db74">partner_name</span>
<span style="color: #e6db74">Partner A        11      4    165.0</span>
<span style="color: #e6db74">Partner B         2      2     19.0</span>
<span style="color: #e6db74">Partner C         5      1    118.5</span>
<span style="color: #e6db74">&quot;&quot;&quot;</span>
</code></pre></div> <p><strong>Example:</strong> Let's limit to Partner A and break down by its campaigns:</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f8f8f2">result</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">wh</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">execute(</span>
    <span style="color: #f8f8f2">metrics</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;sales&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;leads&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;revenue&quot;</span><span style="color: #f8f8f2">],</span>
    <span style="color: #f8f8f2">dimensions</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;campaign_name&quot;</span><span style="color: #f8f8f2">],</span>
    <span style="color: #f8f8f2">criteria</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[(</span><span style="color: #e6db74">&quot;partner_name&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;=&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;Partner A&quot;</span><span style="color: #f8f8f2">)]</span>
<span style="color: #f8f8f2">)</span>

<span style="color: #f8f8f2">print(result</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">df)</span>
<span style="color: #e6db74">&quot;&quot;&quot;</span>
<span style="color: #e6db74">               sales  leads  revenue</span>
<span style="color: #e6db74">campaign_name</span>
<span style="color: #e6db74">Campaign 1A        5      2       83</span>
<span style="color: #e6db74">Campaign 2A        6      2       82</span>
<span style="color: #e6db74">&quot;&quot;&quot;</span>
</code></pre></div> <p><strong>Example:</strong> The output below shows rollups at the campaign level within each partner, and also a rollup of totals at the partner and campaign level.</p> <blockquote> <p><em>Note:</em> the output contains a special character to mark DataFrame rollup rows that were added to the result. The <a href=https://totalhack.github.io/zillion/zillion.report/#reportresult>ReportResult</a> object contains some helper attributes to automatically access or filter rollups, as well as a <code>df_display</code> attribute that returns the result with friendlier display values substituted for special characters. The under-the-hood special character is left here for illustration, but may not render the same in all scenarios.</p> </blockquote> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f92672">from</span> <span style="color: #f8f8f2">zillion</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">RollupTypes</span>

<span style="color: #f8f8f2">result</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">wh</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">execute(</span>
    <span style="color: #f8f8f2">metrics</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;sales&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;leads&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;revenue&quot;</span><span style="color: #f8f8f2">],</span>
    <span style="color: #f8f8f2">dimensions</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;partner_name&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;campaign_name&quot;</span><span style="color: #f8f8f2">],</span>
    <span style="color: #f8f8f2">rollup</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">RollupTypes</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">ALL</span>
<span style="color: #f8f8f2">)</span>

<span style="color: #f8f8f2">print(result</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">df)</span>
<span style="color: #e6db74">&quot;&quot;&quot;</span>
<span style="color: #e6db74">                            sales  leads  revenue</span>
<span style="color: #e6db74">partner_name campaign_name</span>
<span style="color: #e6db74">Partner A    Campaign 1A      5.0    2.0     83.0</span>
<span style="color: #e6db74">             Campaign 2A      6.0    2.0     82.0</span>
<span style="color: #e6db74">             􏿿               11.0    4.0    165.0</span>
<span style="color: #e6db74">Partner B    Campaign 1B      1.0    1.0      6.0</span>
<span style="color: #e6db74">             Campaign 2B      1.0    1.0     13.0</span>
<span style="color: #e6db74">             􏿿                2.0    2.0     19.0</span>
<span style="color: #e6db74">Partner C    Campaign 1C      5.0    1.0    118.5</span>
<span style="color: #e6db74">             􏿿                5.0    1.0    118.5</span>
<span style="color: #e6db74">􏿿            􏿿               18.0    7.0    302.5</span>
<span style="color: #e6db74">&quot;&quot;&quot;</span>
</code></pre></div> <p>See the <code>Report</code> <a href=https://totalhack.github.io/zillion/zillion.report/#report>docs</a> for more information on supported rollup behavior.</p> <p><strong>Example:</strong> Save a report spec (not the data):</p> <p>First you must make sure you have saved your <code>Warehouse</code>, as saved reports are scoped to a particular <code>Warehouse</code> ID. To save a <code>Warehouse</code> you must provide a URL that points to the complete config.</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f8f8f2">name</span> <span style="color: #f92672">=</span> <span style="color: #e6db74">&quot;My Unique Warehouse Name&quot;</span>
<span style="color: #f8f8f2">config_url</span> <span style="color: #f92672">=</span> <span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">some</span> <span style="color: #f8f8f2">url</span> <span style="color: #f8f8f2">pointing</span> <span style="color: #f8f8f2">to</span> <span style="color: #f8f8f2">a</span> <span style="color: #f8f8f2">complete</span> <span style="color: #f8f8f2">warehouse</span> <span style="color: #f8f8f2">config</span><span style="color: #f92672">&gt;</span>
<span style="color: #f8f8f2">wh</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">save(name,</span> <span style="color: #f8f8f2">config_url)</span> <span style="color: #75715e"># wh.id is populated after this</span>

<span style="color: #f8f8f2">spec_id</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">wh</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">save_report(</span>
    <span style="color: #f8f8f2">metrics</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;sales&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;leads&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;revenue&quot;</span><span style="color: #f8f8f2">],</span>
    <span style="color: #f8f8f2">dimensions</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;partner_name&quot;</span><span style="color: #f8f8f2">]</span>
<span style="color: #f8f8f2">)</span>
</code></pre></div> <blockquote> <p><em>Note</em>: If you built your <code>Warehouse</code> in python from a list of <code>DataSources</code>, or passed in a <code>dict</code> for the <code>config</code> param on init, there currently is not a built-in way to output a complete config to a file for reference when saving.</p> </blockquote> <p><strong>Example:</strong> Load and run a report from a spec ID:</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f8f8f2">result</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">wh</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">execute_id(spec_id)</span>
</code></pre></div> <p>This assumes you have saved this report ID previously in the database specified by the DB_URL in your <code>Zillion</code> yaml configuration.</p> <p><strong>Example:</strong> Unsupported Grain</p> <p>If you attempt an impossible report, you will get an <code>UnsupportedGrainException</code>. The report below is impossible because it attempts to break down the leads metric by a dimension that only exists in a child table. Generally speaking, child tables can join back up to parents (and "siblings" of parents) to find dimensions, but not the other way around.</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #75715e"># Fails with UnsupportedGrainException</span>
<span style="color: #f8f8f2">result</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">wh</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">execute(</span>
    <span style="color: #f8f8f2">metrics</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;leads&quot;</span><span style="color: #f8f8f2">],</span>
    <span style="color: #f8f8f2">dimensions</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;sale_id&quot;</span><span style="color: #f8f8f2">]</span>
<span style="color: #f8f8f2">)</span>
</code></pre></div> <hr> <p><a name=advanced-topics></a></p> <h2 id=advanced-topics><strong>Advanced Topics</strong><a class=headerlink href=#advanced-topics title="Permanent link">&para;</a></h2> <p><a name=formula-metrics></a></p> <h3 id=formula-metrics><strong>Formula Metrics</strong><a class=headerlink href=#formula-metrics title="Permanent link">&para;</a></h3> <p>In our example above our config included a formula-based metric called "rpl", which is simply <code>revenue / leads</code>. A <code>FormulaMetric</code> combines other metrics and/or dimensions to calculate a new metric at the Combined Layer of querying. The syntax must match your Combined Layer database, which is SQLite in our example.</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f8f8f2">{</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">&quot;name&quot;</span><span style="color: #f8f8f2">: </span><span style="color: #e6db74">&quot;rpl&quot;</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">&quot;aggregation&quot;</span><span style="color: #f8f8f2">: </span><span style="color: #e6db74">&quot;mean&quot;</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">&quot;rounding&quot;</span><span style="color: #f8f8f2">: </span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">&quot;formula&quot;</span><span style="color: #f8f8f2">: </span><span style="color: #e6db74">&quot;{revenue}/{leads}&quot;</span>
<span style="color: #f8f8f2">}</span>
</code></pre></div> <p><a name=divisor-metrics></a></p> <h3 id=divisor-metrics><strong>Divisor Metrics</strong><a class=headerlink href=#divisor-metrics title="Permanent link">&para;</a></h3> <p>As a convenience, rather than having to repeatedly define formula metrics for rate variants of a core metric, you can specify a divisor metric configuration on a non-formula metric. As an example, say you have a <code>revenue</code> metric and want to create variants for <code>revenue_per_lead</code> and <code>revenue_per_sale</code>. You can define your revenue metric as follows:</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f8f8f2">{</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">&quot;name&quot;</span><span style="color: #f8f8f2">: </span><span style="color: #e6db74">&quot;revenue&quot;</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">&quot;type&quot;</span><span style="color: #f8f8f2">: </span><span style="color: #e6db74">&quot;numeric(10,2)&quot;</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">&quot;aggregation&quot;</span><span style="color: #f8f8f2">: </span><span style="color: #e6db74">&quot;sum&quot;</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">&quot;rounding&quot;</span><span style="color: #f8f8f2">: </span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">&quot;divisors&quot;</span><span style="color: #f8f8f2">: {</span>
<span style="color: #f8f8f2">        </span><span style="color: #f92672">&quot;metrics&quot;</span><span style="color: #f8f8f2">: [</span>
<span style="color: #f8f8f2">            </span><span style="color: #e6db74">&quot;leads&quot;</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">            </span><span style="color: #e6db74">&quot;sales&quot;</span>
<span style="color: #f8f8f2">        ]</span>
<span style="color: #f8f8f2">    }</span>
<span style="color: #f8f8f2">}</span>
</code></pre></div> <p>See <code>zillion.configs.DivisorsConfigSchema</code> for more details on configuration options, such as overriding naming templates, formula templates, and rounding.</p> <p><a name=formula-dimensions></a></p> <h3 id=formula-dimensions><strong>Formula Dimensions</strong><a class=headerlink href=#formula-dimensions title="Permanent link">&para;</a></h3> <p>Experimental support exists for <code>FormulaDimension</code> fields as well. A <code>FormulaDimension</code> can only use other dimensions as part of its formula, and it also gets evaluated in the Combined Layer database. As an additional restriction, a <code>FormulaDimension</code> can not be used in report criteria as those filters are evaluated at the DataSource Layer. The following example assumes a SQLite Combined Layer database:</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f8f8f2">{</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">&quot;name&quot;</span><span style="color: #f8f8f2">: </span><span style="color: #e6db74">&quot;partner_is_a&quot;</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">&quot;formula&quot;</span><span style="color: #f8f8f2">: </span><span style="color: #e6db74">&quot;{partner_name} = &#39;Partner A&#39;&quot;</span>
<span style="color: #f8f8f2">}</span>
</code></pre></div> <p><a name=datasource-formulas></a></p> <h3 id=datasource-formulas><strong>DataSource Formulas</strong><a class=headerlink href=#datasource-formulas title="Permanent link">&para;</a></h3> <p>Our example also includes a metric "sales" whose value is calculated via formula at the DataSource Layer of querying. Note the following in the <code>fields</code> list for the "id" param in the "main.sales" table. These formulas are in the syntax of the particular <code>DataSource</code> database technology, which also happens to be SQLite in our example.</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f92672">&quot;fields&quot;</span><span style="color: #f8f8f2">: [</span>
<span style="color: #f8f8f2">    </span><span style="color: #e6db74">&quot;sale_id&quot;</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    {</span><span style="color: #f92672">&quot;name&quot;</span><span style="color: #f8f8f2">:</span><span style="color: #e6db74">&quot;sales&quot;</span><span style="color: #f8f8f2">, </span><span style="color: #f92672">&quot;ds_formula&quot;</span><span style="color: #f8f8f2">: </span><span style="color: #e6db74">&quot;COUNT(DISTINCT sales.id)&quot;</span><span style="color: #f8f8f2">}</span>
<span style="color: #f8f8f2">]</span>
</code></pre></div> <p><a name=type-conversions></a></p> <h3 id=type-conversions><strong>Type Conversions</strong><a class=headerlink href=#type-conversions title="Permanent link">&para;</a></h3> <p>Our example also automatically created a handful of dimensions from the "created_at" columns of the leads and sales tables. Support for automatic type conversions is limited, but for date/datetime columns in supported <code>DataSource</code> technologies you can get a variety of dimensions for free this way.</p> <p>The output of <code>wh.print_info</code> will show the added dimensions, which are prefixed with "lead_" or "sale_" as specified by the optional <code>type_conversion_prefix</code> in the config for each table. Some examples of auto-generated dimensions in our example warehouse include sale_hour, sale_day_name, sale_month, sale_year, etc. </p> <p>As an optimization in the where clause of underlying report queries, <code>Zillion</code> will try to apply conversions to criteria values instead of columns. For example, it is generally more efficient to query as <code>my_datetime &gt; '2020-01-01' and my_datetime &lt; '2020-01-02'</code> instead of <code>DATE(my_datetime) == '2020-01-01'</code>, because the latter can prevent index usage in many database technologies. The ability to apply conversions to values instead of columns varies by field and <code>DataSource</code> technology as well. </p> <p>To prevent type conversions, set <code>skip_conversion_fields</code> to <code>true</code> on your <code>DataSource</code> config.</p> <p>See <code>zillion.field.TYPE_ALLOWED_CONVERSIONS</code> and <code>zillion.field.DIALECT_CONVERSIONS</code> for more details on currently supported conversions.</p> <p><a name=config-variables></a></p> <h3 id=config-variables><strong>Config Variables</strong><a class=headerlink href=#config-variables title="Permanent link">&para;</a></h3> <p>If you'd like to avoid putting sensitive connection information directly in your <code>DataSource</code> configs you can leverage config variables. In your <code>Zillion</code> yaml config you can specify a <code>DATASOURCE_CONTEXTS</code> section as follows:</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f92672">DATASOURCE_CONTEXTS</span><span style="color: #f8f8f2">:</span>
<span style="color: #f8f8f2">  </span><span style="color: #f92672">my_ds_name</span><span style="color: #f8f8f2">:</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">user</span><span style="color: #f8f8f2">: </span><span style="color: #ae81ff">user123</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">pass</span><span style="color: #f8f8f2">: </span><span style="color: #ae81ff">goodpassword</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">host</span><span style="color: #f8f8f2">: </span><span style="color: #ae81ff">127.0.0.1</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">schema</span><span style="color: #f8f8f2">: </span><span style="color: #ae81ff">reporting</span>
</code></pre></div> <p>Then when your <code>DataSource</code> config for the datasource named "my_ds_name" is read, it can use this context to populate variables in your connection url:</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f92672">&quot;datasources&quot;</span><span style="color: #f8f8f2">: {</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">&quot;my_ds_name&quot;</span><span style="color: #f8f8f2">: {</span>
<span style="color: #f8f8f2">        </span><span style="color: #f92672">&quot;connect&quot;</span><span style="color: #f8f8f2">: </span><span style="color: #e6db74">&quot;mysql+pymysql://{user}:{pass}@{host}/{schema}&quot;</span>
<span style="color: #f8f8f2">        </span><span style="color: #960050; background-color: #1e0010">...</span>
<span style="color: #f8f8f2">    }</span>
<span style="color: #f8f8f2">}</span>
</code></pre></div> <p><a name="DataSource Priority"></a></p> <h3 id=datasource-priority><strong>DataSource Priority</strong><a class=headerlink href=#datasource-priority title="Permanent link">&para;</a></h3> <p>On <code>Warehouse</code> init you can specify a default priority order for datasources by name. This will come into play when a report could be satisfied by multiple datasources. <code>DataSources</code> earlier in the list will be higher priority. This would be useful if you wanted to favor a set of faster, aggregate tables that are grouped in a <code>DataSource</code>.</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f8f8f2">wh</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Warehouse(config</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">config,</span> <span style="color: #f8f8f2">ds_priority</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;aggr_ds&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;raw_ds&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f92672">...</span><span style="color: #f8f8f2">])</span>
</code></pre></div> <p><a name=adhoc-metrics></a></p> <h3 id=ad-hoc-metrics><strong>Ad Hoc Metrics</strong><a class=headerlink href=#ad-hoc-metrics title="Permanent link">&para;</a></h3> <p>You may also define metrics "ad hoc" with each report request. Below is an example that creates a revenue-per-lead metric on the fly. These only exist within the scope of the report, and the name can not conflict with any existing fields:</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f8f8f2">result</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">wh</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">execute(</span>
    <span style="color: #f8f8f2">metrics</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span>
        <span style="color: #e6db74">&quot;leads&quot;</span><span style="color: #f8f8f2">,</span>
        <span style="color: #f8f8f2">{</span><span style="color: #e6db74">&quot;formula&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;{revenue}/{leads}&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;name&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;my_rpl&quot;</span><span style="color: #f8f8f2">}</span>
    <span style="color: #f8f8f2">],</span>
    <span style="color: #f8f8f2">dimensions</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;partner_name&quot;</span><span style="color: #f8f8f2">]</span>
<span style="color: #f8f8f2">)</span>
</code></pre></div> <p><a name=adhoc-dimensions></a></p> <h3 id=ad-hoc-dimensions><strong>Ad Hoc Dimensions</strong><a class=headerlink href=#ad-hoc-dimensions title="Permanent link">&para;</a></h3> <p>You may also define dimensions "ad hoc" with each report request. Below is an example that creates a dimension that partitions on a particular dimension value on the fly. Ad Hoc Dimensions are a subclass of <code>FormulaDimension</code>s and therefore have the same restrictions, such as not being able to use a metric as a formula field. These only exist within the scope of the report, and the name can not conflict with any existing fields:</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f8f8f2">result</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">wh</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">execute(</span>
    <span style="color: #f8f8f2">metrics</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&quot;leads&quot;</span><span style="color: #f8f8f2">],</span>
    <span style="color: #f8f8f2">dimensions</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[{</span><span style="color: #e6db74">&quot;name&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;partner_is_a&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&quot;formula&quot;</span><span style="color: #f8f8f2">:</span> <span style="color: #e6db74">&quot;{partner_name} = &#39;Partner A&#39;&quot;</span><span style="color: #f8f8f2">]</span>
<span style="color: #f8f8f2">)</span>
</code></pre></div> <p><a name=adhoc-tables></a></p> <h3 id=ad-hoc-tables><strong>Ad Hoc Tables</strong><a class=headerlink href=#ad-hoc-tables title="Permanent link">&para;</a></h3> <p><code>Zillion</code> also supports creation or syncing of ad hoc tables in your database during <code>DataSource</code> or <code>Warehouse</code> init. An example of a table config that does this is shown <a href=https://github.com/totalhack/zillion/blob/master/tests/test_adhoc_ds_config.json>here</a>. It uses the table config's <code>data_url</code> and <code>if_exists</code> params to control the syncing and/or creation of the "main.dma_zip" table from a remote CSV in a SQLite database. The same can be done in other database types too.</p> <p>The potential performance drawbacks to such an approach should be obvious, particularly if you are initializing your warehouse often or if the remote data file is large. It is often better to sync and create your data ahead of time so you have complete schema control, but this method can be very useful in certain scenarios.</p> <blockquote> <p><strong>Warning</strong>: be careful not to overwrite existing tables in your database!</p> </blockquote> <p><a name=technicals></a></p> <h3 id=technicals><strong>Technicals</strong><a class=headerlink href=#technicals title="Permanent link">&para;</a></h3> <p>There are a variety of technical computations that can be applied to metrics to compute rolling, cumulative, or rank statistics. For example, to compute a 5-point moving average on revenue one might define a new metric as follows:</p> <div class=codehilite style="background: #272822"><pre style="line-height: 125%;"><span></span><code><span style="color: #f8f8f2">{</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">&quot;name&quot;</span><span style="color: #f8f8f2">: </span><span style="color: #e6db74">&quot;revenue_ma_5&quot;</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">&quot;type&quot;</span><span style="color: #f8f8f2">: </span><span style="color: #e6db74">&quot;numeric(10,2)&quot;</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">&quot;aggregation&quot;</span><span style="color: #f8f8f2">: </span><span style="color: #e6db74">&quot;sum&quot;</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">&quot;rounding&quot;</span><span style="color: #f8f8f2">: </span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">,</span>
<span style="color: #f8f8f2">    </span><span style="color: #f92672">&quot;technical&quot;</span><span style="color: #f8f8f2">: </span><span style="color: #e6db74">&quot;mean(5)&quot;</span>
<span style="color: #f8f8f2">}</span>
</code></pre></div> <p>Technical computations are computed at the Combined Layer, whereas the "aggregation" is done at the DataSource Layer (hence needing to define both above). </p> <p>For more info on how shorthand technical strings are parsed, see the <a href=https://totalhack.github.io/zillion/zillion.configs/#parse_technical_string>parse_technical_string</a> code. For a full list of supported technical types see <code>zillion.core.TechnicalTypes</code>.</p> <p>Technicals also support two modes: "group" and "all". The mode controls how to apply the technical computation across the data's dimensions. In "group" mode, it computes the technical across the last dimension, whereas in "all" mode in computes the technical across all data without any regard for dimensions.</p> <p>The point of this becomes more clear if you try to do a "cumsum" technical across data broken down by something like ["partner_name", "date"]. If "group" mode is used (the default in most cases) it will do cumulative sums <em>within</em> each partner over the date ranges. If "all" mode is used, it will do a cumulative sum across every data row. You can be explicit about the mode by appending it to the technical string: i.e. "cumsum:all" or "mean(5):group"</p> <hr> <p><a name=supported-datasources></a></p> <h2 id=supported-datasources><strong>Supported DataSources</strong><a class=headerlink href=#supported-datasources title="Permanent link">&para;</a></h2> <p><code>Zillion's</code> goal is to support any database technology that SQLAlchemy supports (pictured below). That said the support and testing levels in <code>Zillion</code> vary at the moment. In particular, the ability to do type conversions, database reflection, and kill running queries all require some database-specific code for support. The following list summarizes known support levels. Your mileage may vary with untested database technologies that SQLAlchemy supports (it might work just fine, just hasn't been tested yet). Please report bugs and help add more support!</p> <ul> <li>SQLite: supported</li> <li>MySQL: supported</li> <li>PostgreSQL: supported</li> <li>DuckDB: supported</li> <li>BigQuery, Redshift, Snowflake, SingleStore, PlanetScale, etc: not tested but would like to support these</li> </ul> <p>SQLAlchemy has connectors to many popular databases. The barrier to support many of these is likely pretty low given the simple nature of the sql operations <code>Zillion</code> uses.</p> <p><img alt="SQLAlchemy Connectors" src="https://github.com/totalhack/zillion/blob/master/docs/images/sqlalchemy_connectors.webp?raw=true"></p> <p>Note that the above is different than the database support for the Combined Layer database. Currently only SQLite is supported there; that should be sufficient for most use cases but more options will be added down the road.</p> <p><a name=multiprocess-considerations></a></p> <h2 id=multiprocess-considerations><strong>Multiprocess Considerations</strong><a class=headerlink href=#multiprocess-considerations title="Permanent link">&para;</a></h2> <p>If you plan to run <code>Zillion</code> in a multiprocess scenario, whether on a single node or across multiple nodes, there are a couple of things to consider:</p> <ul> <li>SQLite DataSources do not scale well and may run into locking issues with multiple processes trying to access them on the same node.</li> <li>Any file-based database technology that isn't centrally accessible would be challenging when using multiple nodes.</li> <li>Ad Hoc DataSource and Ad Hoc Table downloads should be avoided as they may conflict/repeat across each process. Offload this to an external ETL process that is better suited to manage those data flows in a scalable production scenario.</li> </ul> <p>Note that you can still use the default SQLite in-memory Combined Layer DB without issues, as that is made on the fly with each report request and requires no coordination/communication with other processes or nodes.</p> <p><a name=related-projects></a></p> <h2 id=related-projects><strong>Related Projects</strong><a class=headerlink href=#related-projects title="Permanent link">&para;</a></h2> <ul> <li><a href=https://github.com/totalhack/zillion-web>Zillion Web UI</a> - A demo UI and web API for Zillion</li> </ul> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=zillion.configs/ title=zillion.configs class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> zillion.configs </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2020 - present @totalhack </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/totalhack/zillion target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=assets/javascripts/vendor.d710d30a.min.js></script> <script src=assets/javascripts/bundle.5f27aba8.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: ".",
          features: [],
          search: Object.assign({
            worker: "assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>